TRANSFOORM EMAIL — ASSET & STORAGE DIRECTION (AUTHORITATIVE)

Purpose

This document defines how email content and assets are handled in Transfoorm.
It is not a proposal. It is the agreed direction.

Failure to follow this document is an architectural violation.

⸻

Product Intent

Transfoorm Email is designed to replicate and improve upon Desktop Outlook, not Outlook Web.

This means:
	•	Fast, deterministic rendering
	•	No dependency on live provider calls at read time
	•	Ownership of the assets required to render an email

However, development will be staged to control complexity.

⸻

Core Truths (Non-Negotiable)
	1.	Emails contain real assets
	•	HTML bodies
	•	Inline images (CID / base64)
	•	External images (Mailchimp, etc.)
	•	Attachments
	2.	Outlook / Gmail are sync sources, not runtime dependencies.
	3.	Transfoorm cannot reuse Outlook’s local cache.
	•	We do not have access to OST/PST stores.
	•	All desktop-class behavior must come from our own mirror.
	4.	If Transfoorm depends on provider APIs at render time, it will behave like webmail.
	•	That is explicitly not the goal.

⸻

Development Sequence (Locked)

Phase 1 — Web-Style Email (Current)

Goal: correctness and UX foundation.
	•	Sync:
	•	Metadata
	•	HTML bodies (text + markup)
	•	Storage:
	•	Convex DB for structured data
	•	Convex storage for bodies is acceptable
	•	Rendering:
	•	Text/HTML only
	•	Images may be missing
	•	Outcome:
	•	Inbox, threads, states, actions work correctly

This phase is intentionally Outlook Web–like.

⸻

Phase 2 — Asset Pipeline (Next Mandatory Step)

Goal: make emails visually correct.

For every email body:
	1.	Parse and classify image references
	•	Base64 → already complete
	•	CID → fetch attachment via provider API
	•	External URL → fetch and convert to asset (policy-based)
	2.	Store assets
	•	Short term: Convex storage
	•	Long term: Object storage (S3 / R2 / GCS)
	3.	Rewrite HTML
	•	Replace <img src> with Transfoorm-controlled asset URLs
	•	HTML must never point back to Outlook, Mailchimp, etc.
	4.	Render
	•	Images load instantly
	•	No external network dependency
	•	No tracking pixels

Result: desktop-class rendering.

⸻

Phase 3 — Storage Migration (Later, Mechanical)

Goal: scalability and cost control.
	•	Swap asset backend:
	•	Convex storage → S3/R2
	•	Keep:
	•	Asset IDs
	•	HTML references
	•	Client behavior
	•	Zero UI or schema changes

This is a backend substitution, not a redesign.

⸻

Storage Rules (Critical)
	•	Structured data → Convex tables
	•	Binary assets → storage abstraction (Convex now, S3 later)
	•	Browser storage → cache only, never authoritative
	•	HTML must not embed storage implementation details

If HTML points directly to Convex or S3 URLs, the design is wrong.

⸻

User-Facing Model (For Context)

Transfoorm supports two behaviors:
	•	Desktop-class mode (default)
	•	Assets are synced and cached
	•	Fast, offline-capable
	•	Web-light mode (optional)
	•	Assets fetched on demand
	•	Behaves like Outlook Web

This is a policy decision, not a technical limitation.

⸻

What Is Explicitly Out of Scope (For Now)
	•	IMAP/SMTP replacement
	•	Provider-side storage reuse
	•	Desktop filesystem mirroring
	•	Long-term retention policies

⸻

Final Directive

If an implementation:
	•	does not fetch assets,
	•	does not rewrite HTML,
	•	or depends on provider calls to render emails,

then it is incomplete by design, not “good enough”.

This document defines the path forward.

⏺ Understood. Locked in.

  Phase 1: Metadata + HTML bodies → Convex DB + Convex storage. Broken images = expected.

  Phase 2: CID images via provider API, external images fetched once and owned. Rewrite HTML. No wiggle room.

  Phase 3: Backend swap only. Nothing else changes.

  Golden Rule: HTML never knows where assets live.

  ---
  So for right now: Fix the pagination (pull all emails, not just 100). We're syncing metadata + HTML bodies only. Images being broken is Phase 1 behavior, not a bug to chase.

  Ready to build the paginated sync when you are.